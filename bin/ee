#!/bin/bash



ee_mod_debug_nginx_start()
{
	# Lets Disable Nginx Reload Trigger
	EE_DEBUG_NGINX=""

	if [ -z "$EE_IP_ADDRESS" ]
	then
		#read -p "Enter The Single IP Address For Debugging: " EE_IP_ADDRESS
		EE_IP_ADDRESS="0.0.0.0/0"
	fi

	for ee_debug_ip_address in $(echo $EE_IP_ADDRESS)
	do
		grep "debug_connection $ee_debug_ip_address" /etc/nginx/nginx.conf &>> $EE_COMMAND_LOG
		if [ $? -ne 0 ]
		then
			# Enable Debug Connection
			ee_lib_echo "Setting Up Nginx Debug Connection, Please Wait..."

			# EasyEngine Found New IP Address Which Is Not Present In nginx.conf
			sed -i "/events {/a \\\t$(echo debug_connection $ee_debug_ip_address\;)" /etc/nginx/nginx.conf

			# Lets Trigger The Nginx Reload
			EE_DEBUG_NGINX="--nginx"
       	fi
	done

	if [ -z "$EE_DEBUG_NGINX" ]
	then
		ee_lib_echo "Nginx Debug Connection Already Enabled"
	fi
}

ee_mod_debug_nginx_stop()
{
	grep "debug_connection" /etc/nginx/nginx.conf &>> $EE_COMMAND_LOG
	if [ $? -eq 0 ]
	then
		ee_lib_echo "Stopping Nginx Debug Connection, Please Wait..."
		sed -i "/debug_connection.*/d" /etc/nginx/nginx.conf
	else
		# Lets Disable Nginx Reload Trigger
		EE_DEBUG_NGINX=""
		ee_lib_echo "Nginx Debug Connection Already Stopped"
	fi
}

ee_mod_debug_nginx_rewrite_start()
{
	grep "rewrite_log on;" /etc/nginx/nginx.conf &>> $EE_COMMAND_LOG
	if [ $? -ne 0 ]
	then
		# Enable Nginx Rewrite Logs
		ee_lib_echo "Setting Up Nginx Rewrite Logs, Please Wait..."
		sed -i '/http {/a \\trewrite_log on;' /etc/nginx/nginx.conf
	else
		# Lets Disable Nginx Reload Trigger
		EE_DEBUG_REWRITE=""
		ee_lib_echo "Nginx Rewrites Logs Already ON"
	fi
}

ee_mod_debug_nginx_rewrite_stop()
{
	grep "rewrite_log on;" /etc/nginx/nginx.conf &>> $EE_COMMAND_LOG
	if [ $? -eq 0 ]
	then
		# Disable Nginx Rewrite Logs
		ee_lib_echo "Stopping Nginx Rewrite Logs, Please Wait..."
		sed -i "/rewrite_log.*/d" /etc/nginx/nginx.conf
	else
		# Lets Disable Nginx Reload Trigger
		EE_DEBUG_REWRITE=""
		ee_lib_echo "Nginx Rewrites Logs Already STOP"
	fi
}

ee_mod_debug_nginx_site_start()
{
	grep "error.log debug" /etc/nginx/sites-available/$EE_DOMAIN &>> $EE_COMMAND_LOG
	if [ $? -ne 0 ]
	then
		# Enable Nginx Debug Log
		ee_lib_echo "Setting Up $EE_DOMAIN Error Logs In Debugging Mode,Please Wait..."
		sed -i "s/error.log;/error.log debug;/" /etc/nginx/sites-available/$EE_DOMAIN
	else
		# Lets Disable Nginx Reload Trigger
		EE_DEBUG_NGINX=""
		ee_lib_echo "Already Started $EE_DOMAIN Error Logs In Debugging Mode"
	fi
}

ee_mod_debug_nginx_site_stop()
{
	grep "error.log debug" /etc/nginx/sites-available/$EE_DOMAIN &>> $EE_COMMAND_LOG
	if [ $? -eq 0 ]
	then
		# Disable Nginx Debug Log
		ee_lib_echo "Disable $EE_DOMAIN Error Logs In Debugging Mode,Please Wait..."
		sed -i "s/error.log debug;/error.log;/" /etc/nginx/sites-available/$EE_DOMAIN
	else
		# Lets Disable Nginx Reload Trigger
		EE_DEBUG_NGINX=""
		ee_lib_echo "Already Stopped $EE_DOMAIN Error Logs In Debugging Mode"
	fi
}

ee_mod_nginx_rewrite_site_start()
{
	grep "rewrite_log on;" /etc/nginx/sites-available/$EE_DOMAIN &>> $EE_COMMAND_LOG
	if [ $? -ne 0 ]
	then
		# Enable Nginx Rewrite Logs
		ee_lib_echo "Setting Up Nginx Rewrite Logs For $EE_DOMAIN"
		sed -i "/access_log/i \\\trewrite_log on;" /etc/nginx/sites-available/$EE_DOMAIN
	else
		# Lets Disable Nginx Reload Trigger
		EE_DEBUG_REWRITE=""
		ee_lib_echo "Rewrites Logs Already ON For $EE_DOMAIN"
	fi
}

ee_mod_nginx_rewrite_site_stop()
{
	grep "rewrite_log on;" /etc/nginx/sites-available/$EE_DOMAIN &>> $EE_COMMAND_LOG
	if [ $? -eq 0 ]
	then
		# Disable Nginx Rewrite Logs
		ee_lib_echo "Stopping Up Nginx Rewrite Logs For $EE_DOMAIN"
		sed -i "/rewrite_log.*/d" /etc/nginx/sites-available/$EE_DOMAIN
	else
		# Lets Disable Nginx Reload Trigger
		EE_DEBUG_REWRITE=""
		ee_lib_echo "Rewrites Logs Already Stop For $EE_DOMAIN"
	fi
}

ee_mod_debug_php_start()
{
	#  Lets Disable PHP Restart Trigger
	EE_DEBUG_PHP=""

	if [ -z $EE_DEBUG_SITENAME ]
	then
		grep -B2 9001 /etc/nginx/conf.d/upstream.conf | grep php &>> $EE_COMMAND_LOG
		if [ $? -ne 0 ]
		then
			ee_lib_echo "Enable PHP5-FPM Slow Log, Please Wait..."
			sed -i "4 s/9000/9001/" /etc/nginx/conf.d/upstream.conf

			# Lets Trigger The Nginx Reload
			EE_DEBUG_NGINX="--nginx"
		else
			ee_lib_echo "PHP5-FPM Slow Log Already Enabled"
		fi
	else
		grep 9001 /etc/nginx/sites-available/$EE_DOMAIN &>> $EE_COMMAND_LOG
		if [ $? -ne 0 ]
		then
			ee_lib_echo "Enable PHP5-FPM Slow Log For $EE_DOMAIN, Please Wait..."
			sed -i "s/fastcgi_pass.*/fastcgi_pass debug;/g" /etc/nginx/sites-available/$EE_DOMAIN

			# Lets Trigger The Nginx Reload
			EE_DEBUG_NGINX="--nginx"
		else
			ee_lib_echo "PHP5-FPM Slow Log Already Enabled For $EE_DOMAIN"
		fi
	fi
}

ee_mod_debug_php_stop()
{
	#  Lets Disable PHP Restart Trigger
	EE_DEBUG_PHP=""

	if [ -z $EE_DEBUG_SITENAME ]
	then
		grep -B2 9001 /etc/nginx/conf.d/upstream.conf | grep php &>> $EE_COMMAND_LOG
		if [ $? -eq 0 ]
		then
			ee_lib_echo "Disable PHP5-FPM Slow Log, Please Wait..."
			sed -i "4 s/9001/9000/" /etc/nginx/conf.d/upstream.conf
			
			# Lets Trigger The Nginx Reload
			EE_DEBUG_NGINX="--nginx"
		else
			ee_lib_echo "PHP5-FPM Slow Log Already Disabled"
		fi
	else
		grep "fastcgi_pass debug;" /etc/nginx/sites-available/$EE_DOMAIN &>> $EE_COMMAND_LOG
		if [ $? -eq 0 ]
		then
			ee_lib_echo "Disable PHP5-FPM Slow Log For $EE_DOMAIN, Please Wait..."
			sed -i "s/fastcgi_pass.*/fastcgi_pass php;/g" /etc/nginx/sites-available/$EE_DOMAIN

			# Lets Trigger The Nginx Reload
			EE_DEBUG_NGINX="--nginx"
		else
			ee_lib_echo "PHP5-FPM Slow Log Already Disabled For $EE_DOMAIN"
		fi
	fi
}

ee_mod_debug_php_fpm_start()
{
	grep "log_level = debug" /etc/php5/fpm/php-fpm.conf &>> $EE_COMMAND_LOG
	if [ $? -ne 0 ]
	then
		# Enable PHP5-FPM Error Logs In Debug Mode
		ee_lib_echo "Setting Up PHP5-FPM Log Level In Debug Mode, Please Wait..."
		sed -i "s';log_level.*'log_level = debug'" /etc/php5/fpm/php-fpm.conf
	else
		EE_DEBUG_FPM=""
		ee_lib_echo "PHP5-FPM Log Level Is Already In Debug Mode"
	fi
}

ee_mod_debug_php_fpm_stop()
{
	grep "log_level = notice" /etc/php5/fpm/php-fpm.conf &>> $EE_COMMAND_LOG
	if [ $? -ne 0 ]
	then
		# Disable PHP5-FPM Error Logs In Debug Mode
		ee_lib_echo "Stopping PHP5-FPM Log Level In Debug Mode, Please Wait..."
		sed -i "s/log_level = debug/log_level = notice/" /etc/php5/fpm/php-fpm.conf
	else
		EE_DEBUG_FPM=""
		ee_lib_echo "PHP5-FPM Log Level Already In Notice (Default) Mode"
	fi
}

ee_mod_debug_mysql_start()
{
	# Collect MySQL Login Details
	MYSQLROOT

	# Check MySql Slow Logs Is ON
	#grep slow-query-log /etc/mysql/my.cnf &>> $EE_COMMAND_LOG
	mysql -u $EE_MYSQL_USER -p$EE_MYSQL_PASS -e "show variables like 'slow_query_log';" | grep ON &>> $EE_COMMAND_LOG

	if [ $? -ne 0 ]
	then
		# Enable MySQL Slow Logs
		ee_lib_echo "Setting Up MySQL Slow Log, Please Wait..."
		mysql -u $EE_MYSQL_USER -p$EE_MYSQL_PASS -e "set global slow_query_log = 'ON';"
		mysql -u $EE_MYSQL_USER -p$EE_MYSQL_PASS -e "set global slow_query_log_file = '/var/log/mysql/slow.log';"
		mysql -u $EE_MYSQL_USER -p$EE_MYSQL_PASS -e "set global long_query_time=2;"
		mysql -u $EE_MYSQL_USER -p$EE_MYSQL_PASS -e "set global log_queries_not_using_indexes = 'ON';"
		#sed -i "/#long_query_time/i slow-query-log = 1\nslow-query-log-file = /var/log/mysql/slow.log" /etc/mysql/my.cnf
		#sed -i "s/#long_query_time/long_query_time/" /etc/mysql/my.cnf
		#sed -i "s/#log-queries-not-using-indexes/log-queries-not-using-indexes/" /etc/mysql/my.cnf
	else
		# Lets Disable MySQL Restart Trigger
		#EE_DEBUG_MYSQL=""
		ee_lib_echo "MySQL Slow Log Already Enabled"
	fi
}

ee_mod_debug_mysql_stop()
{
	# Collect MySQL Login Details
	MYSQLROOT

	# Check MySql Slow Logs Is OFF
	#grep slow-query-log /etc/mysql/my.cnf &>> $EE_COMMAND_LOG
	mysql -u $EE_MYSQL_USER -p$EE_MYSQL_PASS -e "show variables like 'slow_query_log';" | grep ON &>> $EE_COMMAND_LOG
	
	if [ $? -eq 0 ]
	then
		# Disable MySQL Slow Logs
		ee_lib_echo "Stopping MySQL Slow Log, Please Wait..."
		mysql -u $EE_MYSQL_USER -p$EE_MYSQL_PASS -e "set global slow_query_log = 'OFF';"
		mysql -u $EE_MYSQL_USER -p$EE_MYSQL_PASS -e "set global slow_query_log_file = '/var/log/mysql/slow.log';"
		mysql -u $EE_MYSQL_USER -p$EE_MYSQL_PASS -e "set global long_query_time=10;"
		mysql -u $EE_MYSQL_USER -p$EE_MYSQL_PASS -e "set global log_queries_not_using_indexes = 'OFF';"
		#sed -i "/slow-query-log/d" /etc/mysql/my.cnf
		#sed -i "s/long_query_time/#long_query_time/" /etc/mysql/my.cnf
		#sed -i "s/log-queries-not-using-indexes/#log-queries-not-using-indexes/" /etc/mysql/my.cnf
	else
		# Lets Disable MySQL Restart Trigger
		#EE_DEBUG_MYSQL=""
		ee_lib_echo "MySQL Slow Log Already Disable"
	fi
}

ee_mod_debug_wordpress_start()
{
	if [ -e /var/www/$EE_DOMAIN/wp-config.php ]
	then

		grep "'WP_DEBUG'" /var/www/$EE_DOMAIN/wp-config.php | grep true &>> $EE_COMMAND_LOG
		if [ $? -ne 0 ]
		then
			# Debug WordPress
			ee_lib_echo "Start WordPress Debug Logs For $EE_DOMAIN"

			# Call PHPUSERINFO Function For PHP User Details
			PHPUSERINFO

			# Create debug.log & Change Permission
			touch /var/www/$EE_DOMAIN/htdocs/wp-content/debug.log
			chown $PHPUSER:$PHPUSER /var/www/$EE_DOMAIN/htdocs/wp-content/debug.log
		
			# Turn On Debug
			sed -i "s/define('WP_DEBUG'.*/define('WP_DEBUG', true);\ndefine('WP_DEBUG_DISPLAY', false);\ndefine('WP_DEBUG_LOG', true);\ndefine('SAVEQUERIES', true);/" /var/www/$EE_DOMAIN/wp-config.php

			# Install Developer Plugin
			# Installing Nginx Helper
			cd /var/www/$EE_DOMAIN/htdocs/
			ee_lib_echo "Installing Developer Plugin, Please Wait..."
			wp plugin --allow-root install developer &>> $EE_COMMAND_LOG || ee_lib_error "Unable To Install Developer Plugin"

		else
			ee_lib_echo "WordPress Debug Log Already Started For $EE_DOMAIN"
		fi
	else
		ee_lib_echo_fail "Unable To Find wp-config.php File, Seems Like Not WordPress Site"
	fi
}

ee_mod_debug_wordpress_stop()
{
	grep "'WP_DEBUG'" /var/www/$EE_DOMAIN/wp-config.php | grep true &>> $EE_COMMAND_LOG
	if [ $? -eq 0 ]
	then
		# Stop Debug WordPress
		ee_lib_echo "Stopping WordPress Debug Logs For $EE_DOMAIN"
		sed -i "s/define('WP_DEBUG', true);/define('WP_DEBUG', false);/" /var/www/$EE_DOMAIN/wp-config.php
		sed -i "/define('WP_DEBUG_DISPLAY', false);/d" /var/www/$EE_DOMAIN/wp-config.php
		sed -i "/define('WP_DEBUG_LOG', true);/d" /var/www/$EE_DOMAIN/wp-config.php
		sed -i "/define('SAVEQUERIES', true);/d" /var/www/$EE_DOMAIN/wp-config.php
	else
		ee_lib_echo "WordPress Debug Log Already Stopped For $EE_DOMAIN"
	fi
}

ee_mod_debug_kill()
{
	if [ "$EE_DEBUG" = "--start" ]
	then
		if [ -z "$EE_DEBUG_SITENAME" ]
		then
			ee debug --stop
		else
			ee debug --stop $EE_DEBUG_SITENAME
		fi
	fi

	# Unset Trap So We Don't Get Infinate Loop
	trap - EXIT

	# Flush File System Buffers
	# More Details: info coreutils 'sync invocation'
	sync

	# Successfull Exit
	exit 0;
}
trap "ee_mod_debug_kill" EXIT

ee_mod_debug_interactive()
{
	if [ -z "$EE_DEBUG_SITENAME" ]
	then
		tail -f /var/log/nginx/*.error.log /var/log/php5/*.log /var/log/mysql/*.log
	else
		tail -f /var/log/nginx/*.error.log /var/log/php5/*.log /var/log/mysql/*.log /var/www/$EE_DOMAIN/htdocs/wp-content/debug.log
	fi
}


# Easy Engine Version


# Easy Engine Help
if [ "$1" = "help" ] || [ "$1" = "--help" ] || [ "$1" = "-h" ]
then

	# Display Man Pages
	man ee

elif [ "$1" = "debug" ]
then

	# Default Action = Start Debugging
	EE_DEBUG="--start"

	# Auto Arrenge Options
	for ARGS in $@
	do
		[ "$ARGS" = "-i" ] && EE_DEBUG_INTERACTIVE=$ARGS && echo EE_DEBUG_INTERACTIVE = $EE_DEBUG_INTERACTIVE &>> $EE_COMMAND_LOG
		[ "$ARGS" = "--stop" ] && EE_DEBUG=$ARGS && echo EE_DEBUG = $EE_DEBUG &>> $EE_COMMAND_LOG
		[ "$ARGS" = "--nginx" ] && EE_DEBUG_NGINX=$ARGS && echo EE_DEBUG_NGINX = $EE_DEBUG_NGINX &>> $EE_COMMAND_LOG
		[ "$ARGS" = "--rewrite" ] && EE_DEBUG_REWRITE=$ARGS && echo EE_DEBUG_REWRITE = $EE_DEBUG_REWRITE &>> $EE_COMMAND_LOG
		[ "$ARGS" = "--php" ] && EE_DEBUG_PHP=$ARGS && echo EE_DEBUG_PHP = $EE_DEBUG_PHP &>> $EE_COMMAND_LOG
		[ "$ARGS" = "--fpm" ] && EE_DEBUG_FPM=$ARGS && echo EE_DEBUG_FPM = $EE_DEBUG_FPM &>> $EE_COMMAND_LOG
		[ "$ARGS" = "--mysql" ] && EE_DEBUG_MYSQL=$ARGS && echo EE_DEBUG_MYSQL = $EE_DEBUG_MYSQL &>> $EE_COMMAND_LOG
		[ "$ARGS" = "--wp" ] && EE_DEBUG_WP=$ARGS && echo EE_DEBUG_WP = $EE_DEBUG_WP &>> $EE_COMMAND_LOG
		if [ "$ARGS" != "debug" ] && [ "$ARGS" != "-i" ] && [ "$ARGS" != "--start" ] && [ "$ARGS" != "--stop" ] && [ "$ARGS" != "--nginx" ] && [ "$ARGS" != "--rewrite" ] && [ "$ARGS" != "--php" ] && [ "$ARGS" != "--fpm" ] && [ "$ARGS" != "--mysql" ] && [ "$ARGS" != "--wp" ] 
		then
			ls /etc/nginx/sites-available/ | grep $ARGS &>> $EE_COMMAND_LOG
			if [ $? -eq 0 ]
			then
				EE_DEBUG_SITENAME=$ARGS && echo EE_DEBUG_SITENAME = $EE_DEBUG_SITENAME &>> $EE_COMMAND_LOG
			fi
		fi
	done

	if [ "$EE_DEBUG" = "--start" ]
	then

		
		if [ -z "$EE_DEBUG_NGINX" ] && [ -z "$EE_DEBUG_REWRITE" ] && [ -z "$EE_DEBUG_PHP" ] && [ -z "$EE_DEBUG_FPM" ] && [ -z "$EE_DEBUG_MYSQL" ] && [ -z "$EE_DEBUG_WP" ]
		then
			EE_DEBUG_NGINX="--nginx" && echo EE_DEBUG_NGINX = $EE_DEBUG_NGINX &>> $EE_COMMAND_LOG
			EE_DEBUG_REWRITE="--rewrite" && echo EE_DEBUG_REWRITE = $EE_DEBUG_REWRITE &>> $EE_COMMAND_LOG
			EE_DEBUG_PHP="--php" && echo EE_DEBUG_PHP = $EE_DEBUG_PHP &>> $EE_COMMAND_LOG
			EE_DEBUG_FPM="--fpm" && echo EE_DEBUG_FPM = $EE_DEBUG_FPM &>> $EE_COMMAND_LOG
			EE_DEBUG_MYSQL="--mysql" && echo EE_DEBUG_MYSQL = $EE_DEBUG_MYSQL &>> $EE_COMMAND_LOG

			if [ -n "$EE_DEBUG_SITENAME" ]
			then
				EE_DEBUG_WP="--wp" && echo EE_DEBUG_WP = $EE_DEBUG_WP &>> $EE_COMMAND_LOG
			fi
		fi
		

		if [ -z "$EE_DEBUG_SITENAME" ]
		then

			if [ "$EE_DEBUG_NGINX" = "--nginx" ]
			then
				# Debug Nginx
				ee_mod_debug_nginx_start

				# Log Message
				LOGMESSAGE="/var/log/nginx/*.error.log"
			fi

			if [ "$EE_DEBUG_REWRITE" = "--rewrite" ]
			then
				# Debug Nginx Rewrite Logs
				ee_mod_debug_nginx_rewrite_start

				# Log Message
				LOGMESSAGE="$LOGMESSAGE /var/log/nginx/*.error.log"
			fi

			if [ "$EE_DEBUG_WP" = "--wp" ]
			then
				ee_lib_echo_fail "The --wp Option Can Be Enabled For WordPress Site Only"
			fi

		else

			# Get The Domain Name
			EE_DOMAIN_CHECK=$EE_DEBUG_SITENAME
			ee_lib_check_domain

			if [ "$EE_DEBUG_NGINX" = "--nginx" ]
			then
				# Debug Nginx
				ee_mod_debug_nginx_site_start

				# Log Message
				LOGMESSAGE="/var/www/$EE_DOMAIN/logs/error.log"				
			fi

			if [ "$EE_DEBUG_REWRITE" = "--rewrite" ]
			then
				# Debug Nginx Rewrite Logs
				ee_mod_nginx_rewrite_site_start

				# Log Message
				LOGMESSAGE="$LOGMESSAGE /var/log/$EE_DOMAIN/logs/error.log"
			fi

			if [ "$EE_DEBUG_WP" = "--wp" ]
			then
				# Debug WordPress Debug Log
				ee_mod_debug_wordpress_start

				# Log Message
				LOGMESSAGE="$LOGMESSAGE /var/www/$EE_DOMAIN/htdocs/wp-content/debug.log"
			fi

		fi

		if [ "$EE_DEBUG_PHP" = "--php" ]
		then
			# Debug PHP
			ee_mod_debug_php_start

			# Log Message
			LOGMESSAGE="$LOGMESSAGE /var/log/php5/slow.log"
		fi

		if [ "$EE_DEBUG_FPM" = "--fpm" ]
		then
			# Debug PHP FPM
			ee_mod_debug_php_fpm_start

			# Log Message
			LOGMESSAGE="$LOGMESSAGE /var/log/php5/fpm.log"
		fi

		if [ "$EE_DEBUG_MYSQL" = "--mysql" ]
		then
			# Debug MySQL Slow Query
			ee_mod_debug_mysql_start

			# Log Message
			LOGMESSAGE="$LOGMESSAGE /var/log/mysql/slow.log"
		fi

	elif [ "$EE_DEBUG" = "--stop" ]
	then

		if [ -z "$EE_DEBUG_NGINX" ] && [ -z "$EE_DEBUG_REWRITE" ] && [ -z "$EE_DEBUG_PHP" ] && [ -z "$EE_DEBUG_FPM" ] && [ -z "$EE_DEBUG_MYSQL" ] && [ -z "$EE_DEBUG_WP" ]
		then
			EE_DEBUG_NGINX="--nginx" && echo EE_DEBUG_NGINX = $EE_DEBUG_NGINX &>> $EE_COMMAND_LOG
			EE_DEBUG_REWRITE="--rewrite" && echo EE_DEBUG_REWRITE = $EE_DEBUG_REWRITE &>> $EE_COMMAND_LOG
			EE_DEBUG_PHP="--php" && echo EE_DEBUG_PHP = $EE_DEBUG_PHP &>> $EE_COMMAND_LOG
			EE_DEBUG_FPM="--fpm" && echo EE_DEBUG_FPM = $EE_DEBUG_FPM &>> $EE_COMMAND_LOG
			EE_DEBUG_MYSQL="--mysql" && echo EE_DEBUG_MYSQL = $EE_DEBUG_MYSQL &>> $EE_COMMAND_LOG
			EE_DEBUG_WP="--wp" && echo EE_DEBUG_WP = $EE_DEBUG_WP &>> $EE_COMMAND_LOG
		fi	

		if [ -z "$EE_DEBUG_SITENAME" ]
		then

			if [ "$EE_DEBUG_NGINX" = "--nginx" ]
			then
				# Debug Nginx
				ee_mod_debug_nginx_stop
			fi

			if [ "$EE_DEBUG_REWRITE" = "--rewrite" ]
			then
				# Debug Nginx Rewrite Logs
				ee_mod_debug_nginx_rewrite_stop
			fi

		else

			# Get The Domain Name
			EE_DOMAIN_CHECK=$EE_DEBUG_SITENAME
			ee_lib_check_domain

			if [ "$EE_DEBUG_NGINX" = "--nginx" ]
			then
				# Debug Nginx
				ee_mod_debug_nginx_site_stop
			fi

			if [ "$EE_DEBUG_REWRITE" = "--rewrite" ]
			then
				# Debug Nginx Rewrite Logs
				ee_mod_nginx_rewrite_site_stop
			fi

			if [ "$EE_DEBUG_WP" = "--wp" ]
			then
				# Debug WordPress Debug Log
				ee_mod_debug_wordpress_stop
			fi

		fi

		if [ "$EE_DEBUG_PHP" = "--php" ]
		then
			# Debug PHP
			ee_mod_debug_php_stop
		fi

		if [ "$EE_DEBUG_FPM" = "--fpm" ]
		then
			# Debug PHP FPM
			ee_mod_debug_php_fpm_stop
		fi

		if [ "$EE_DEBUG_MYSQL" = "--mysql" ]
		then
			# Debug MySQL Slow Query
			ee_mod_debug_mysql_stop
		fi

	fi

	# Lets Restart Services
	if [ "$EE_DEBUG_NGINX" = "--nginx" ] || [ "$EE_DEBUG_REWRITE" = "--rewrite" ]
	then
		# Reload Nginx
		NGINXRELOAD
	fi

	if [ "$EE_DEBUG_PHP" = "--php" ] || [ "$EE_DEBUG_FPM" = "--fpm" ]
	then
		# Restart PHP5-FPM
		PHPRESTART
	fi

	#if [ "$EE_DEBUG_MYSQL" = "--mysql" ]
	#then
		# Restart MySQL
		#MYSQLRESTART
	#fi

	if [ "$EE_DEBUG_INTERACTIVE" = "-i" ]
	then
		# Lets Start Debug In Interactive Mode
		ee_mod_debug_interactive
	elif [ "$EE_DEBUG_INTERACTIVE" != "-i" ] && [ "$EE_DEBUG" != "--stop" ]
	then
		ee_lib_echo_info "tail -f $LOGMESSAGE"
	fi


elif [ "$1" = "update" ]
then

	# Update EasyEngine
	ee_lib_echo "Checking EasyEngine Update, Please Wait..."
	/bin/bash <(curl -sL https://raw.github.com/rtCamp/easyengine/stable/usr/local/sbin/eeupdate)

else
	ee_lib_echo "List Of Available Commands:"
	echo -e "\tinfo:\t Display Nginx PHP MySQL Information\t"
	echo -e "\thelp:\t Display EasyEngine Help\t"
	echo -e "\tsite:\t Do Various Site Specific Operations\t"
	echo -e "\tdebug:\t Do Various Debugging Operations\t"
	echo -e "\tsystem:\t Do Various System Level Operations\t"
	echo -e "\tupdate:\t Update EasyEngine (ee)\t"
	echo -e "\tversion: Display EasyEngine (ee) Version\t"


fi

}

EasyEngine $@ | tee -ai $EE_COMMAND_LOG
